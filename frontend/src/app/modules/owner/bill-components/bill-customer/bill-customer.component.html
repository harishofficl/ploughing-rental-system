<div class="main-header">
  <h1 class="main-heading">Bill Customer</h1>
</div>

<form [formGroup]="billForm" (ngSubmit)="onSubmit()" class="create-bill-form">
  <!-- Customer Search -->
  <div class="form-group search-customer-container">
    <label for="customer" class="form-label"
      >Customer <span class="required-asterisk">*</span></label
    >
    <div class="customer-search">
      <input
        id="customer"
        formControlName="customerId"
        type="text"
        class="form-control search-customer-input"
        (input)="searchCustomers($event)"
        placeholder="Search Customer"
      />
      <ul *ngIf="customers.length > 0" class="suggestions">
        <li
          *ngFor="let customer of customers"
          (click)="selectCustomer(customer)"
        >
          {{ customer.name }}
        </li>
      </ul>
      <div class="customer-clear-button-container flex">
        <button
          class="clear-button"
          *ngIf="changeCustomerDisplay"
          (click)="changeCustomer()"
        >
          Change Customer
        </button>
      </div>
      <p
        class="no-customer-text"
        *ngIf="
          noCustomerDisplay &&
          customers.length === 0 &&
          (searchTerms | async) !== null
        "
      >
        No customers found
      </p>
    </div>
  </div>

  <!-- Rental Records Table -->
  <div class="rental-records-container">
    <label class="form-label">Rental Records</label>
    <div class="form-label-message" *ngIf="unpaidRecords.length === 0">
      Select customer to fetch their unpaid records...
    </div>
    <div class="form-control list-rental-records" [hidden]="unpaidRecords.length === 0">
      <!-- <mat-form-field appearance="fill" class="filter-field">
        <mat-label>Filter records</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Type to search" />
      </mat-form-field> -->

      <table
        mat-table
        [dataSource]="dataSource"
        matSort
        class="custom-mat-table mat-elevation-z8"
      >
        <!-- Select Checkbox -->
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox
              class="custom-checkbox"
              (change)="toggleAllRows($event)"
              [checked]="isAllSelected()"
              [indeterminate]="isSomeSelected()"
            ></mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox
              class="custom-checkbox"
              [checked]="selection.isSelected(row)"
              (change)="toggleRowSelection(row)"
            ></mat-checkbox>
          </td>
        </ng-container>

        <!-- Equipment -->
        <ng-container matColumnDef="equipment">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Equipment</th>
          <td mat-cell *matCellDef="let record">{{ record.equipment }}</td>
        </ng-container>

        <!-- Date -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
          <td mat-cell *matCellDef="let record">
            {{ record.date | date : "shortDate" }}
          </td>
        </ng-container>

        <!-- Hours Used -->
        <ng-container matColumnDef="hoursUsed">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Hours Used</th>
          <td mat-cell *matCellDef="let record">{{ record.hoursUsed }}</td>
        </ng-container>

        <!-- Total Cost -->
        <ng-container matColumnDef="totalCost">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Cost</th>
          <td mat-cell *matCellDef="let record">â‚¹{{ record.totalCost }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <mat-paginator
        [pageSize]="10"
        [pageSizeOptions]="[2, 5, 10, 20]"
        showFirstLastButtons
      ></mat-paginator>
    </div>
  </div>

  <!-- Total Amount -->
  <div class="form-group">
    <label for="totalAmount" class="form-label">Total Amount</label>
    <input
      id="totalAmount"
      formControlName="totalAmount"
      type="number"
      class="form-control"
      readonly
    />
  </div>

  <!-- Payment Method -->
  <div class="form-group">
    <label for="isPaid" class="form-label">Payment Method</label>
    <select id="isPaid" formControlName="paid" class="form-control">
      <option [ngValue]="true">Cash</option>
      <option [ngValue]="false">Online Payment</option>
    </select>
  </div>

  <!-- Online Payment Type -->
  <div class="form-group" *ngIf="billForm.get('paid')?.value === false">
    <label for="allMethods" class="form-label">Online Payment Type</label>
    <select id="allMethods" formControlName="allMethods" class="form-control">
      <option [ngValue]="true">All online payment methods</option>
      <option [ngValue]="false">UPI Only</option>
    </select>
  </div>

  <!-- Submit -->
  <button
    type="submit"
    class="submit-button"
    [disabled]="billForm.invalid || billForm.get('totalAmount')?.value <= 0"
  >
    Generate Bill
  </button>
</form>
